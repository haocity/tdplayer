function $d(a){return document.getElementById(a)}function $c(a){return document.querySelectorAll(a)}function hasClass(a,b){return!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function addClass(a,b){hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){hasClass(a,b)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "))}function getstyle(a){var b,c,d;for(b=0;b<document.styleSheets.length;b++)for(c=document.styleSheets[b].cssRules?document.styleSheets[b].cssRules:document.styleSheets[b].rules,d=0;d<c.length;d++)if(c[d].selectorText==a)return c[d].style}function acplay(a,b){var d,c=document.createElement("div");c.className="dm-loding",a.appendChild(c),c.innerText="正在加载中...",d=new XMLHttpRequest,d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){tdplayer.data=d.responseText,tdplayer.videoinfo=JSON.parse(tdplayer.data).info,tdplayer.nowdata=JSON.parse(tdplayer.data).danmu,c.innerText=c.innerText+"\n获取视频弹幕信息成功..",c.innerText=c.innerText+"\n正在解析视频地址";var e;e=new XMLHttpRequest,e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status){var b=e.responseText;tdplayer.videosrcarr=JSON.parse(b).video,tdplayer.videosrcarr?Tdplayer(a,tdplayer.videosrcarr,tdplayer.videoinfo.coverImage):c.innerText=c.innerText+"\n视频解析失败"}else c.innerText=c.innerText+"\n视频解析失败"},e.open("GET","https://t5.haotown.cn/acfun/video/?ac="+b,!0),e.send()}},d.open("GET","https://t5.haotown.cn/acfun/danmu/?ac="+b,!0),d.send()}function Tdplayer(a,b,c){function f(a,b){var c=a.duration;if(c){if(tdplayer.videotimearr[b]=c,tdplayer.videotimearr[0]&&tdplayer.videotimearr[tdplayer.videotimearr.length-1]){for(tdplayer.alltime=0,b=0;b<tdplayer.videotimearr.length;b++)tdplayer.alltime+=tdplayer.videotimearr[b];$d("video-control-alltime").innerHTML=r(tdplayer.alltime).m+":"+r(tdplayer.alltime).s}}else setTimeout(function(){f(a,b)},500)}function g(a){getstyle(".dm-left").animation="dmleft "+a+"s linear",getstyle(".dm-left").webkitAnimation="dmleft "+a+"s linear"}function h(a){var b=encodeURIComponent(a)+"=",c="",d=document.cookie.indexOf(b),e=null;return d>-1&&(e=document.cookie.indexOf(";",d),-1==e&&(e=document.cookie.length),c=decodeURIComponent(document.cookie.substring(d+b.length,e))),c}function i(){var b,a=0;for(b=0;b<=tdplayer.nowduan-1;b++)a+=tdplayer.videotimearr[b];return a+=tdplayer.videoelearr[tdplayer.nowduan].currentTime}function j(){var c,d,e,f,g,h,j,a=i(),b=tdplayer.videoelearr[tdplayer.nowduan].currentTime;for($d("tranger-a").style.width=100*(a/tdplayer.alltime)+"%",c=tdplayer.videoelearr[tdplayer.nowduan].buffered,d=0;d<c.length;d++)if(c.start(d)<=b&&b<c.end(d)){for(e=tdplayer.nowduan-1,f=0,g=0,d=0;e>=d;d++)f+=tdplayer.videotimearr[d],tdplayer.videoelearr[tdplayer.nowduan].buffered.end(d)&&(g=f+tdplayer.videoelearr[tdplayer.nowduan].buffered.end(d));h=100*(g/tdplayer.alltime)+"%",$d("tranger-c").style.width!=h&&($d("tranger-c").style.width=h);break}if(tdplayer.nowdata)for(j=parseInt(10*a),d=0;d<tdplayer.nowdata.length;d++)tdplayer.nowdata[d]&&tdplayer.nowdata[d].time==j&&(tdplayer.send(unescape(tdplayer.nowdata[d].text),tdplayer.nowdata[d].color,tdplayer.nowdata[d].place),delete tdplayer.nowdata[d])}function k(a){var c,b=0;for(c=0;c<tdplayer.videotimearr.length;c++)if(b+=tdplayer.videotimearr[c],b>=a)return c}function l(a){var d,e,f,b=k(a)-1,c=0;for(d=0;b>=d;d++)c+=tdplayer.videotimearr[d];for(e=a-c,tdplayer.nowduan=k(a),d=0;d<tdplayer.videoelearr.length;d++)d!=tdplayer.nowduan?(f=tdplayer.videoelearr[d],f.style.display="none",f.currentTime=0,f.pause()):(f=tdplayer.videoelearr[d],tdplayer.Element=f,f.style.display="block",f.play(),f.currentTime=e,$d("dm-spinner").style.display="none")}function m(a){var b=a.offsetTop;return null!=a.offsetParent&&(b+=m(a.offsetParent)),b}function n(a){var b=a.offsetLeft;return null!=a.offsetParent&&(b+=n(a.offsetParent)),b}function o(a,b){var c=a.clientX-n(b),d=a.clientY-m(b),e=c/b.offsetWidth,f=d/b.offsetTop;return{x:c,y:d,w:b.offsetWidth,xbl:e,ybl:f}}function p(){var a,b;for(console.log("loding"),clearInterval(tdplayer.Interval),tdplayer.dsq=0,$d("dm-spinner").style.display="block",a=$d("danmu").getElementsByTagName("div"),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend")}function q(){var a,b;if($d("dm-spinner").style.display="block")for(0==tdplayer.dsq&&(tdplayer.Interval=setInterval(j,100),tdplayer.dsq=1),a=$d("danmu").getElementsByTagName("div"),$d("dm-spinner").style.display="none",$d("video-control-alltime").innerHTML=r(tdplayer.alltime).m+":"+r(tdplayer.alltime).s,b=a.length-1;b>=0;b--)removeClass(a[b],"dm-suspend")}function r(a){var b,c=parseInt(a/60);return b=parseInt(a%60)>=10?parseInt(a%60):"0"+parseInt(a%60),{m:c,s:b}}function s(){$d("dm-video-y").style.opacity="1",tdplayer.sjc++,setTimeout(t,2e3,tdplayer.sjc)}function t(a){a>=tdplayer.sjc&&($d("dm-video-y").style.opacity="0")}var d,e,u,v,w,x,y,z,A,B,C,D;for(tdplayer.warp=a,tdplayer.videosrcarr=b,tdplayer.vposter=c,tdplayer.nowduan=0,tdplayer.v='<div class="dm-video-warp"id="dm-video-warp"><div class="dm-video-main"id="dm-video-main"><ul class="dm-rightmenu"><li class="tp-speend-con">播放速度 <ul class="tp-speend"><li>0.5</li><li>0.75</li><li>正常</li><li>1.25</li><li>1.5</li><li>2</li></ul></li><a href="https://github.com/haocity/tdplayer/issues" target="_blank"><li>意见反馈</li></a><a href="https://www.haotown.cn/about.html" target="_blank"><li>关于作者</li></a><a href="https://github.com/haocity/tdplayer" target="_blank"><li>About tdplayer</li></a></ul><div id="tdplayer"></div><div id="danmu"></div><div class="dm-oneplay"id="dm-oneplay"><svg style="width: 200px;height:200px;"class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg></div><div class="dm-spinner"id="dm-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div><div id="dm-video-y"class="dm-video-y"><div class="dm-send"id="dm-send"><div class="dm-logo-small"></div><input class="dm-tucao"type="text"id="dm-text"required="true"placeholder="客官，不来吐槽一下吗?"autocomplete="off"><div class="tp-color"><div class="tp-color-bo" id="tp-color-bo" style="background-color: rgb(255, 255, 255)"></div><div class="tp-con" id="tp-con"><div class="tp-place" id="tp-place">◀滚动弹幕</div><div id="tp-color-warp"></div></div></div><input class="dm-post"id="dm-up"type="submit"value="发送"></div><div id="video-control"class="video-control"><div style="float:right;"><span id="video-control-alltime" style="padding-right:6px">0:00</span><div class="dm-dmk"id="dm-dmk">弹</div><div class="dm-syk"id="dm-syk"><span class="dm-syk-ico">♫</span><input id="dm-syk-range" type="range"name="points"min="0"max="100"value="100"/></div><svg id="video-full"style="width: 20px;padding-right:30px;top: 9px;"xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"class="dm-icon"style=""viewBox="0 0 1024 1024"version="1.1"p-id="1427"><defs><style type="text/css"><![CDATA[]]></style></defs><path d="M971.862 52.538c-10.964-10.992-25.546-17.044-41.056-17.044L429.616 35.494l0 79.362 479.86 0 0 465.288 79.364 0L988.84 93.524C988.84 78.024 982.802 63.46 971.862 52.538z"p-id="1428"/><path d="M115.092 429.62 35.728 429.62l0 500.854c0 15.5 6.038 30.066 16.982 40.994 10.966 10.988 25.544 17.04 41.05 17.04l469.182 0 0-79.364L115.092 909.144 115.092 429.62z"p-id="1429"/><path d="M127.16 193.578l73.198 73.198-0.034 0.034 40.438 40.44 14.164 14.096 152.616 152.616c8.796 8.796 20.492 13.64 32.932 13.64 12.442 0 24.138-4.846 32.936-13.644 18.158-18.16 18.156-47.708-0.002-65.866l-141.318-141.318 0.094-0.094-40.484-40.486-14.162-13.97L192.812 127.492l146.47 0 0-92L101.16 35.492c-36.392 0-66 29.608-66 66l0 237.972 92 0L127.16 193.578z"p-id="1430"/><path d="M896.578 830.358l-73.198-73.198 0.034-0.034-40.44-40.44-14.148-14.084-152.622-152.62c-8.796-8.8-20.496-13.648-32.942-13.648-12.444 0-24.14 4.848-32.94 13.646-18.148 18.156-18.148 47.702 0.004 65.866l141.31 141.306-0.094 0.094 40.492 40.494 14.16 13.974 84.728 84.726-146.734 0 0 92 238.386 0c36.392 0 66-29.608 66-66l0-237.96-92 0L896.574 830.358z"p-id="1431"/></svg></div><div style="float: left;"><svg id="video-control-play"class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg><svg id="video-control-paused"style="display:none" class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M256.033769 192.014198l127.977743 0 0 639.933741-127.977743 0 0-639.933741ZM639.976 191.982l127.993 0 0 639.966-127.993 0 0-639.966z"/></svg><span id="video-control-nowtime">0:00</span></div><div id="tranger" class="tranger" ><div class="tranger-a" id="tranger-a"></div><div class="tranger-b"></div><div id="tranger-c" class="tranger-c"></div></div></div></div></div></div>',tdplayer.warp.innerHTML=tdplayer.v,console.log("ok"),d=0;d<tdplayer.videosrcarr.length;d++)e=document.createElement("video"),e.src=tdplayer.videosrcarr[d],e.className="dm-video",0!=d?(e.style.display="none",e.preload="meta"):(e.preload="load",tdplayer.Element=e),$d("tdplayer").appendChild(e);for(tdplayer.videoelearr=$d("tdplayer").getElementsByTagName("video"),tdplayer.videotimearr=[],d=0;d<tdplayer.videoelearr.length;d++)f(tdplayer.videoelearr[d],d);for(tdplayer.Element.poster=tdplayer.vposter,tdplayer.danmuelement=$d("danmu"),tdplayer.sjc=0,tdplayer.dsq=0,tdplayer.leftarr=[],tdplayer.toparr=[],tdplayer.dmheight=31,tdplayer.dmplace=1,tdplayer.width=tdplayer.Element.offsetWidth,tdplayer.height=tdplayer.Element.offsetHeight,tdplayer.send=function(a,b,c,d){var e,f,g,h,i,j,k;tdplayer.width=tdplayer.Element.offsetWidth,tdplayer.height=tdplayer.Element.offsetHeight,e=document.createElement("div"),e.appendChild(document.createTextNode(a)),e.style.color=b,d&&(e.style.border="1px solid #fff"),1==c?(f=tdplayer.getlefttop(),e.style.top=f*tdplayer.dmheight+"px",tdplayer.leftarr[f]=1,e.className="danmu dm-left",e.style.transform="translateX(-"+tdplayer.width+"px)",g=$d("danmu").appendChild(e),h=g.offsetWidth,i=h+tdplayer.width,j=i/10,k=h/j,setTimeout(function(){tdplayer.leftarr[f]=0},1e3*k+500),e.addEventListener("webkitAnimationEnd",tdplayer.dmend),e.addEventListener("animationend",tdplayer.dmend)):2==c&&(e.className="danmu dm-top",f=tdplayer.gettoptop(),e.style.top=f*tdplayer.dmheight+"px",tdplayer.toparr[f]=1,g=$d("danmu").appendChild(e),setTimeout(function(){tdplayer.danmuhide(g,f)},5e3))},tdplayer.dmend=function(){tdplayer.danmuelement.removeChild(this)},tdplayer.danmuhide=function(a,b){tdplayer.Element.paused?setTimeout(function(){tdplayer.danmuhide(a,b)},10*tdplayer.width+1e3):(a.remove(),tdplayer.toparr[b]=0)},tdplayer.getlefttop=function(){var a,b;for(b=0;b<=tdplayer.leftarr.length;b++)if(!tdplayer.leftarr[b]){a=b;break}return a},tdplayer.gettoptop=function(){var a,b;for(b=0;b<=tdplayer.toparr.length;b++)if(!tdplayer.toparr[b]){a=b;break}return a},$d("dm-dmk").addEventListener("click",function(){"dm-dmk"==this.className?(this.className="dm-dmk dm-dmk-c",$d("danmu").style.opacity="0"):(this.className="dm-dmk",$d("danmu").style.opacity="1")}),$d("dm-text").onkeydown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0];13==b.keyCode&&$d("dm-up").click()},$d("dm-up").addEventListener("click",function(){var a,b;tdplayer.send($d("dm-text").value,$d("tp-color-bo").style.backgroundColor,tdplayer.dmplace,1),$d("dm-text").readonly="readonly",$d("dm-up").disabled="true",$d("dm-up").style.background="#777479",setTimeout(function(){$d("dm-text").value="",$d("dm-up").disabled="",$d("dm-up").style.background="#8715EF"},500),a={id:tdplayer.videoid,text:$d("dm-text").value,color:$d("tp-color-bo").style.backgroundColor,time:parseInt(10*tdplayer.Element.currentTime),place:tdplayer.dmplace},a=function(a){var c,b="";for(c in a)b+=c+"="+a[c]+"&";return b}(a),b=new XMLHttpRequest,b.open("POST",tdplayer.sendurl,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.onreadystatechange=function(){var c,a=b;4==a.readyState&&200==a.status&&(c=a.responseText,console.log(c))}}),$d("video-control-play").onclick=function(){var a,b;for($d("dm-oneplay").style.display="none",0==tdplayer.dsq&&(tdplayer.Interval=setInterval(j,100),tdplayer.dsq=1),$d("dm-video-y").style.opacity="0",a=$d("danmu").getElementsByTagName("div"),this.style.display="none",$d("video-control-paused").style.display="inline-block",tdplayer.Element.play(),b=a.length-1;b>=0;b--)removeClass(a[b],"dm-suspend")},$d("video-control-paused").onclick=function(){var a,b;for(clearInterval(tdplayer.Interval),tdplayer.dsq=0,a=$d("danmu").getElementsByTagName("div"),this.style.display="none",$d("video-control-play").style.display="inline-block",tdplayer.Element.pause(),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend");$d("dm-spinner").style.display="none"},$d("dm-oneplay").addEventListener("click",function(){this.style.display="none",$d("video-control-play").onclick()}),$d("dm-video-y").onmousemove=function(){s()},tdplayer.changersound=function(){var a=7,b=new Date;b.setTime(b.getTime()+1e3*60*60*24*a),document.cookie="tpsound="+parseInt($d("dm-syk-range").value)+";expires="+b.toGMTString()+"&path=/"},tdplayer.soundcookie=h("tpsound"),tdplayer.soundcookie?($d("dm-syk-range").value=tdplayer.soundcookie,tdplayer.Element.volume=.01*parseInt($d("dm-syk-range").value)):tdplayer.changersound(),$d("dm-syk").onmousemove=function(){$d("dm-syk-range").style.width="70px",$d("dm-syk-range").style.opacity="1"},$d("dm-syk").onmouseout=function(){$d("dm-syk-range").style.width="1px",$d("dm-syk-range").style.opacity="0"},$d("dm-syk-range").addEventListener("click",function(){var a=.01*parseInt($d("dm-syk-range").value);tdplayer.Element.volume=a,tdplayer.changersound()}),setInterval(function(){var e,f,g,a=i(),b=tdplayer.videoelearr[tdplayer.nowduan].currentTime;if(b+10>=tdplayer.videotimearr[tdplayer.nowduan]&&tdplayer.videoelearr[tdplayer.nowduan+1]&&(tdplayer.videoelearr[tdplayer.nowduan+1].preload="load"),b==tdplayer.videotimearr[tdplayer.nowduan]&&(console.log("正在播放下一段"),tdplayer.videoelearr[tdplayer.nowduan+1]))for(tdplayer.nowduan++,tdplayer.videoelearr[tdplayer.nowduan-1],tdplayer.videoelearr[tdplayer.nowduan],e=0;e<tdplayer.videoelearr.length;e++)e!=tdplayer.nowduan?(f=tdplayer.videoelearr[e],"none"!=f.style.display&&(f.style.display="none"),f.currentTime=0,f.pause()):(f=tdplayer.videoelearr[e],tdplayer.Element=f,f.style.display="block",f.play(),f.currentTime=0);$d("video-control-nowtime").innerHTML=r(a).m+":"+r(a).s,g=$d("dm-send").offsetWidth-280+"px",$d("dm-text").style.width!=g&&($d("dm-text").style.width=g)},1e3),$d("tranger").onmousedown=function(){"none"!=$d("video-control-play").display&&$d("video-control-play").onclick();var a=o(event,this);$d("tranger-a").style.width=100*a.xbl+"%",l(a.xbl*tdplayer.alltime),tdplayer.nowdata=JSON.parse(tdplayer.data).danmu},d=0;d<tdplayer.videoelearr;d++)d.addEventListener("waiting",p),tdplayer.Element.addEventListener("playing",function(){q()});for(document.onkeydown=function(a){var c,b=a||window.event||arguments.callee.caller.arguments[0];s(),b&&39==b.keyCode&&(c=tdplayer.Element.currentTime,tdplayer.Element.currentTime=c+5),b&&37==b.keyCode&&(c=tdplayer.Element.currentTime,tdplayer.Element.currentTime=c-5,tdplayer.nowdata=JSON.parse(tdplayer.data).danmu),b&&32==b.keyCode&&$d("danmu").click(),b&&38==b.keyCode&&($d("dm-syk-range").value=parseInt($d("dm-syk-range").value)+1,$d("dm-syk-range").click()),b&&40==b.keyCode&&($d("dm-syk-range").value=parseInt($d("dm-syk-range").value)-1,$d("dm-syk-range").click())},$d("video-full").addEventListener("click",function(){var a=$d("dm-video-warp");document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),setTimeout(function(){var a,b;for(tdplayer.width=$d("danmu").offsetWidth,a=$d("danmu").getElementsByTagName("div"),g(tdplayer.width/100),b=0;b<a.length;b++)hasClass(a[b],"dm-left")&&(a[b].style.transform="translateX(-"+tdplayer.width+"px)")},1e3)}),tpcolor=new Object,tpcolor.arr=new Array("#FFFFFF","#000000","#4ab0c6","#555656","#09b745","#f86141","#FFEB3B","#4d38d8","#fe67c1","#ff9c07"),u=255;u>=0;u-=25)for(v=0;255>=v;v+=25)for(w=0;255>=w;w+=25)tpcolor.arr.push("rgb("+u+","+v+","+w+")");for(x=$d("tp-con"),y=$d("tp-color-warp"),$d("tp-color-bo").addEventListener("click",function(){x.style.display="block"==x.style.display?"none":"block"}),tpcolor.i=0;tpcolor.i<tpcolor.arr.length;tpcolor.i++)z=document.createElement("div"),z.className="tp-color",A=document.createElement("div"),A.className="tp-color-main",A.style.background=tpcolor.arr[tpcolor.i],A.addEventListener("click",function(){$d("tp-color-bo").style.backgroundColor=this.style.background}),z.appendChild(A),y.appendChild(z);for($c(".tp-speend-con")[0].addEventListener("click",function(){var a=$c(".tp-speend")[0];a.style.display="block"==a.style.display?"none":"block"}),B=$c(".tp-speend")[0].childNodes,d=0;d<B.length;d++)C=B[d],D=parseFloat(B[d].innerText).toFixed(2),C.onclick="NaN"!=D?function(){var a=parseFloat(this.innerText).toFixed(2);$c(".dm-video")[0].playbackRate=a}:function(){$c(".dm-video")[0].playbackRate=1};$c("#danmu")[0].onmousedown=function(){var c,d,e,f,g,h,i,a=$c(".dm-video-warp")[0],b=$c(".dm-rightmenu")[0];2==event.button?(b.style.display="block",c=window.event||arguments[0],f=$d("danmu").offsetHeight,g=$d("danmu").offsetWidth,f==document.documentElement.clientHeight?(e=c.clientY,d=c.clientX,d+b.offsetWidth>g&&(d=g-b.offsetWidth),e+b.offsetWidth>f&&(e=f-b.offsetHeight)):(e=c.clientY+document.body.scrollTop-a.offsetTop,d=c.clientX-a.offsetLeft,h=a.offsetWidth,i=a.offsetHeight,d+b.offsetWidth>h&&(d=h-b.offsetWidth),e+b.offsetHeight>i&&(e=i-b.offsetHeight)),window.document.all?(this.IContextmenuHander=function(){return!1},document.attachEvent("oncontextmenu",this.IContextmenuHander)):(this.IContextmenuHander=document.oncontextmenu,document.oncontextmenu=function(){return!1}),b.style.top=e+"px",b.style.left=d+"px"):0==event.button&&("block"==b.style.display?b.style.display="none":tdplayer.Element.paused?$d("video-control-play").onclick():$d("video-control-paused").onclick())},$d("tp-place").addEventListener("click",function(){1==tdplayer.dmplace?(tdplayer.dmplace=2,this.innerText="▲顶部弹幕"):(tdplayer.dmplace=1,this.innerText="◀滚动弹幕")})}var tdplayer=new Object;